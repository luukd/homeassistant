- id: plants_notification
  alias: "Plants notification"
  trigger:
    - platform: state
      entity_id: group.all_plants
      from: "ok"
      to: "problem"
    - platform: state
      entity_id: device_tracker.iphone_van_luuk
      to: "home"
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.all_plants
        state: "problem"
      - condition: state
        entity_id: device_tracker.iphone_van_luuk
        state: "home"
  action:
    - service: notify.ios_iphone_van_luuk
      data:
        title: "Planten water geven"
        message: "De planten drogen uit!"

- id: tv_scene_start
  alias: "TV started"
  trigger:
    - platform: state
      entity_id: binary_sensor.harmony_tv_activity
      to: 'on'
    - platform: state
      entity_id: binary_sensor.dark_outside
      to: 'on'
      for:
        minutes: 15
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: binary_sensor.harmony_tv_activity
        state: 'on'
      - condition: state
        entity_id: binary_sensor.dark_outside
        state: 'on'
  action:
    service: scene.turn_on
    entity_id: scene.film
 
- id: home_lights
  alias: "Turn on lights"
  trigger:
    - platform: state
      entity_id: binary_sensor.iemand_thuis
      to: 'on'
    - platform: state
      entity_id: binary_sensor.dark_outside
      to: 'on'
      for:
        minutes: 15
    - platform: state
      entity_id: binary_sensor.harmony_tv_activity
      to: 'off'
  action:
    service: scene.turn_on
    entity_id: scene.thuis
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: binary_sensor.dark_outside
        state: 'on'
      - condition: state
        entity_id: binary_sensor.iemand_thuis
        state: 'on'
      - condition: state
        entity_id: binary_sensor.harmony_tv_activity
        state: 'off'
      - condition: state
        entity_id: input_boolean.slapen
        state: 'off'

- alias: "Turn off lights"
  trigger:
    - platform: state
      entity_id: binary_sensor.iemand_thuis
      to: 'off'
    - platform: state
      entity_id: binary_sensor.dark_outside
      to: 'off'
      for:
        minutes: 15
    - platform: state
      entity_id: binary_sensor.harmony_tv_activity
      to: 'off'
  action:
    - service: scene.turn_on
      entity_id: scene.lampen_uit
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: 'binary_sensor.dark_outside'
        state: 'off'
      - condition: state
        entity_id: 'binary_sensor.iemand_thuis'
        state: 'off'

- alias: Woonkamer switch
  id: woonkamer_switch
  hide_entity: True
  trigger:
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.wall_switch_158d00015f2255
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.wall_switch_158d00015766fb
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.wall_switch_left_158d000183f47d
  action:
    service: light.toggle
    entity_id: group.lights_woonkamer

- alias: Spotify speaker wissel naar keuken
  id: spotify_speaker_switch_to_kitchen
  hide_entity: True
  trigger:
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.wall_switch_both_158d000183f47d
  condition:
    - condition: state
      entity_id: binary_sensor.spotify_playing_to_receiver
      state: "on"
  action:
    service: media_player.select_source
    entity_id: media_player.spotify
    data:
      source: "Keuken"

- alias: Spotify speaker wissel naar woonkamer
  id: spotify_speaker_switch_to_living_room
  hide_entity: True
  trigger:
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.wall_switch_both_158d000183f47d
  condition:
    - condition: state
      entity_id: binary_sensor.spotify_playing_to_kitchen
      state: "on"
  action:
    service: media_player.select_source
    entity_id: media_player.spotify
    data:
      source: "Huiskamer"

- id: harmony_activity_airplay
  alias: "Activate Harmony activity when playing AirPlay"
  hide_entity: True
  trigger:
    platform: state
    entity_id: media_player.yamaha_receiver
    to: 'playing'
  condition:
    - condition: template
      value_template: '{{ states.remote.harmony_hub.attributes.current_activity != "AirPlay" }}'
    - condition: template
      value_template: '{{ trigger.to_state.attributes.source == "AirPlay" }}'
  action:
    - service: remote.turn_on
      entity_id: remote.harmony_hub
      data:
        activity: AirPlay

- id: harmony_activity_spotify_start
  alias: "Activate Harmony activity when playing Spotify"
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.spotify_playing_to_receiver
      from: 'off'
      to: 'on'
  condition:
    - condition: template
      value_template: '{{ states.remote.harmony_hub.attributes.current_activity != "Spotify" }}'
  action:
    - service: remote.turn_on
      entity_id: remote.harmony_hub
      data:
        activity: Spotify

- id: harmony_activity_spotify_stop
  alias: "Stop Harmony activity when playing Spotify"
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.spotify_playing_to_receiver
      from: 'on'
      to: 'off'
      for:
        minutes: 15
  condition:
    - condition: template
      value_template: '{{ states.remote.harmony_hub.attributes.current_activity == "Spotify" }}'
  action:
    - service: remote.turn_off
      entity_id: remote.harmony_hub

- id: harmony_activity_chromecast
  alias: "Activate Chrome Cast activity when casting"
  hide_entity: True
  trigger:
    platform: state
    entity_id: media_player.woonkamer
    to: 'playing'
  condition:
    - condition: template
      value_template: '{{ states.remote.harmony_hub.attributes.current_activity != "Watch Chromecast" }}'
  action:
    - service: remote.turn_on
      entity_id: remote.harmony_hub
      data:
        activity: "Watch Chromecast"

- id: vacuum_cleaner_schedule
  alias: "Stofzuigen"
  trigger:
    platform: state
    entity_id: binary_sensor.iemand_thuis
    to: 'off'
  condition:
    - condition: time
      after: "07:00:00"
      before: "12:00:00"
      weekday:
        - mon
        - fri
  action:
    - service: script.turn_on
      entity_id: script.start_vacuum_cleaner
    - service: notify.ios_iphone_van_luuk
      data:
        message: "Stofzuiger is gestart"

- id: wasmachine_bezig
  alias: "Wasmachine bezig"
  hide_entity: True
  trigger:
    - platform: numeric_state
      entity_id: sensor.wasmachine_actueel_verbruik
      above: 100
  action:
    - service: input_boolean.turn_on
      entity_id: input_boolean.wasmachine_bezig

- id: wasmachine_klaar
  alias: "Wasmachine klaar"
  hide_entity: True
  trigger:
    - platform: numeric_state
      entity_id: sensor.wasmachine_actueel_verbruik
      below: 9
  action:
    - service: input_boolean.turn_off
      entity_id: input_boolean.wasmachine_bezig

- id: wasmachine_klaar_notification
  alias: Wasmachine klaar notification
  trigger:
    - platform: state
      entity_id: input_boolean.wasmachine_bezig
      from: 'on'
      to: 'off'
      for:
        minutes: 8
  action:
    - service: notify.ios_iphone_van_luuk
      data:
        title: "Wasmachine: "
        message: "Ik ben klaar!"

- alias: Lampen keuken schakelaar
  id: kitchen_lights_switch
  hide_entity: True
  trigger:
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.wall_switch_right_158d000183f47d
  action:
    service: light.toggle
    entity_id: group.lights_keuken

- alias: Lampen keuken aan bij beweging
  id: kitchen_lights_on
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.bewegingssensor_keuken
      to: 'on'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.lights_keuken
        state: 'off'
      - condition: state
        entity_id: binary_sensor.dark_outside
        state: 'on'
  action:
    - service: light.turn_on
      entity_id: group.lights_keuken

- alias: Lampen keuken uit bij geen beweging
  id: kitchen_lights_off
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.bewegingssensor_keuken
      to: 'off'
      for:
        minutes: 5
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.lights_keuken
        state: 'on'
  action:
    - service: light.turn_off
      entity_id: group.lights_keuken

- alias: Lamp hal voordeur aan
  id: hall_front_door_lights_on
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor_158d0001ab31bc
      to: 'on'
  condition:
    - condition: numeric_state
      entity_id: sensor.illumination_158d0001ab31bc
      below: 35
  action:
    - service: light.turn_on
      entity_id: light.lamp_hal_voordeur

- alias: Lampen hal voordeur uit
  id: hall_front_door_lights_off
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor_158d0001ab31bc
      to: 'off'
  action:
    - service: light.turn_off
      entity_id: light.lamp_hal_voordeur

- alias: Lampen hal aan
  id: hall_lights_on
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor_158d0001ad6a52
      to: 'on'
  condition:
    - condition: numeric_state
      entity_id: sensor.illumination_158d0001ad6a52
      below: 35
  action:
    - service: light.turn_on
      entity_id: light.lamp_hal_achter

- alias: Lampen hal uit
  id: hall_lights_off
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor_158d0001ad6a52
      to: 'off'
      for:
        minutes: 1
  action:
    - service: light.turn_off
      entity_id: light.lamp_hal_achter
      
- alias: Lampen overloop aan
  id: overloop_lights_on_day
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor_158d0001e470dc
      to: 'on'
    - platform: state
      entity_id: input_boolean.slapen
      to: 'off'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: binary_sensor.motion_sensor_158d0001e470dc
        state: 'on'
      - condition: numeric_state
        entity_id: sensor.illumination_158d0001e470dc
        below: 20
      - condition: state
        entity_id: input_boolean.slapen
        state: 'off'
  action:
    - service: light.turn_on
      data:
        entity_id: light.overloop
        profile: default
      
- alias: Lampen overloop aan s'nachts
  id: overloop_lights_on_night
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor_158d0001e470dc
      to: 'on'
    - platform: state
      entity_id: input_boolean.slapen
      to: 'on'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: binary_sensor.motion_sensor_158d0001e470dc
        state: 'on'
      - condition: numeric_state
        entity_id: sensor.illumination_158d0001e470dc
        below: 30
      - condition: state
        entity_id: input_boolean.slapen
        state: 'on'
  action:
    - service: light.turn_on
      data:
        entity_id: light.overloop
        profile: night

- alias: Lampen overloop uit
  id: overloop_lights_off
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor_158d0001e470dc
      to: 'off'
      for:
        minutes: 1
  action:
    - service: light.turn_off
      entity_id: light.overloop

- alias: Activeer slapen met knop
  id: slapen_switch
  trigger:
    platform: event
    event_type: click
    event_data:
      entity_id: binary_sensor.switch_158d00016c22e6
      click_type: single
  condition:
    - condition: state
      entity_id: input_boolean.slapen
      state: 'off'
  action:
    service: scene.turn_on
    entity_id: scene.slapen

- alias: Opstaan
  trigger:
    - platform: time
      at: "07:30:00"
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.switch_158d00016c22e6
        click_type: single
  condition:
    - condition: state
      entity_id: input_boolean.slapen
      state: 'on'
  action:
    service: scene.turn_on
    entity_id: scene.opstaan

- id: request_location_update
  alias: Locatie update
  hide_entity: True
  trigger:
    - platform: state
      entity_id:
      - binary_sensor.motion_sensor_158d0001ad6a52
      - binary_sensor.motion_sensor_158d0001ab31bc
      to: 'on'
  condition:
    - condition: state
      entity_id: binary_sensor.iemand_thuis
      state: 'off'
  action:
    service: notify.ios_iphone_van_luuk
    data:
      message: "request_location_update"

- id: notify_start_heating
  alias: Verwarming inschakelen notificatie
  trigger:
    - platform: time
      at: "17:00:00"
  condition:
    condition: and
    conditions:
      - condition: numeric_state
        entity_id: sensor.woonkamer_temperature
        below: 17.5
      - condition: state
        entity_id: binary_sensor.iemand_thuis
        state: 'off'
      - condition: time
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
  action:
    service: notify.ios_iphone_van_luuk
    data:
      title: "Alvast huis opwarmen?"
      message: "Het is thuis {{ states('sensor.woonkamer_temperature') }}°C. Verwarming alvast aanzetten?"
      data:
        push:
          category: "start_heating"

- id: handle_notification_start_heating
  alias: Verwarming inschakelen notificatie afhandelen
  hide_entity: True
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: START_HEATING
  action:
    - service: climate.set_temperature
      data:
        entity_id: climate.woonkamer
        temperature: 20

- id: mailbox_notification
  alias: "Brievenbusnotificatie"
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.door_window_sensor_158d0001b147ce
      to: "on"
  action:
    - service: notify.ios_iphone_van_luuk
      data:
        title: "Brievenbus:"
        message: "Er is (waarschijnlijk) post!"

- id: battery_low_notification
  alias: "Batterij bijna leeg notificatie"
  hide_entity: True
  trigger:
    - platform: numeric_state
      entity_id:
      - binary_sensor.door_window_sensor_158d0001b147ce
      - binary_sensor.door_window_sensor_158d0001e48a17
      - binary_sensor.door_window_sensor_158d0001e481df
      - binary_sensor.motion_sensor_158d0001ab31bc
      - binary_sensor.motion_sensor_158d0001ad6a52
      - binary_sensor.motion_sensor_158d0001e470dc
      - binary_sensor.switch_158d00016c22e6
      - binary_sensor.switch_158d0001d62bf9
      - binary_sensor.wall_switch_158d00015766fb
      - binary_sensor.wall_switch_158d000157670b
      - binary_sensor.wall_switch_158d00015f2255
      - binary_sensor.wall_switch_both_158d000183f47d
      - sensor.temperature_158d0001b91ff4
      - sensor.temperature_158d0001b95352
      value_template: '{{ state.attributes.battery_level }}'
      below: 10
      for:
        hours: 1
  action:
    - service: notify.ios_iphone_van_luuk
      data:
        title: "Batterij bijna leeg"
        message: 'De batterij van {{ trigger.from_state.attributes.friendly_name }} is bijna leeg ({{ trigger.from_state.attributes.battery_level }})'
    - service: persistent_notification.create
      data:
        title: "Batterij bijna leeg"
        message: 'De batterij van {{ trigger.from_state.attributes.friendly_name }} is bijna leeg ({{ trigger.from_state.attributes.battery_level }})'

- id: zwave_heal
  alias: heal at 2:32am
  hide_entity: True
  trigger:
    platform: time
    at: '2:32:00'
  action:
    service: zwave.heal_network

- id: ssl_certificate_expiry_warning
  alias: "SSL certificaat notificatie"
  hide_entity: True
  trigger:
    platform: numeric_state
    entity_id: sensor.ssl_certificate_expiry
    below: 15
    for:
      hours: 18
  action:
    - service: notify.ios_iphone_van_luuk
      data:
        title: "SSL certificaten verlopen binnenkort"
        message: "De LetsEncrypt SSL certificaten verlopen binnen {{ states('sensor.ssl_certificate_expiry') }} dagen."
    - service: persistent_notification.create
      data:
        title: "SSL certificaten verlopen binnenkort"
        message: "De LetsEncrypt SSL certificaten verlopen binnen {{ states('sensor.ssl_certificate_expiry') }} dagen."