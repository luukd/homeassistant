- id: update_ventilation_slider
  alias: Ventilatie slider bijwerken
  trigger:
    platform: state
    entity_id: sensor.ventilation_current_mode
  condition:
    condition: template
    value_template: '{{ states.input_number.ventilation.state != states.sensor.ventilation_current_mode.state }}'
  action:
    service: input_number.set_value
    data_template:
      entity_id: input_number.ventilation
      value: "{{ states.sensor.ventilation_current_mode.state }}"

- id: ventilation_switches_1
  alias: Ventilatie switches 1
  hide_entity: True
  trigger:
    - platform: state
      entity_id: input_number.ventilation
      to: "1.0"
  condition:
    condition: template
    value_template: '{{ states.input_number.ventilation.state != states.sensor.ventilation_current_mode.state }}'
  action:
    - service: switch.turn_off
      entity_id: switch.qubino_zmnhbdx_flush_2_relays_switch_2
    - service: switch.turn_off
      entity_id: switch.qubino_zmnhbdx_flush_2_relays_switch_3

- id: ventilation_switches_2
  alias: Ventilatie switches 2
  hide_entity: True
  trigger:
    - platform: state
      entity_id: input_number.ventilation
      to: "2.0"
  condition:
    condition: template
    value_template: '{{ states.input_number.ventilation.state != states.sensor.ventilation_current_mode.state }}'
  action:
    - service: switch.turn_off
      entity_id: switch.qubino_zmnhbdx_flush_2_relays_switch_2
    - service: switch.turn_on
      entity_id: switch.qubino_zmnhbdx_flush_2_relays_switch_3

- id: ventilation_switches_3
  alias: Ventilatie switches 3
  hide_entity: True
  trigger:
    - platform: state
      entity_id: input_number.ventilation
      to: "3.0"
  condition:
    condition: template
    value_template: '{{ states.input_number.ventilation.state != states.sensor.ventilation_current_mode.state }}'
  action:
    - service: switch.turn_off
      entity_id: switch.qubino_zmnhbdx_flush_2_relays_switch_3
    - service: switch.turn_on
      entity_id: switch.qubino_zmnhbdx_flush_2_relays_switch_2

- id: doorbell_notification
  alias: "Doorbell notification"
  trigger:
    - platform: state
      entity_id: binary_sensor.doorbell
      to: "on"
  action:
    - service: notify.ios_iphone_van_luuk
      data:
        title: "Deurbel: "
        message: "Er wordt aangebeld!"

- id: doorbell_reset
  alias: "Set doorbell to off 30 seconds after ringing"
  trigger:
    - platform: state
      entity_id: binary_sensor.doorbell
      to: "on"
      for:
        seconds: 30
  action:
    service: mqtt.publish
    data:
      topic: "home/RF2toMQTT/CODE_8318190/UNIT_0/GROUP_1/PERIOD_253"
      payload: "0"

- id: plants_notification
  alias: "Plants notification"
  trigger:
    - platform: state
      entity_id: group.all_plants
      from: "ok"
      to: "problem"
    - platform: state
      entity_id: device_tracker.iphone_van_luuk
      to: "home"
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.all_plants
        state: "problem"
      - condition: state
        entity_id: device_tracker.iphone_van_luuk
        state: "home"
  action:
    - service: notify.ios_iphone_van_luuk
      data:
        title: "Planten water geven"
        message: "De planten drogen uit!"

- id: tv_scene_start
  alias: "TV started"
  trigger:
    - platform: state
      entity_id: binary_sensor.harmony_tv_activity
      to: 'on'
    - platform: state
      entity_id: binary_sensor.dark_outside
      to: 'on'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: binary_sensor.harmony_tv_activity
        state: 'on'
      - condition: state
        entity_id: binary_sensor.dark_outside
        state: 'on'
  action:
    service: scene.turn_on
    entity_id: scene.film
 
- id: home_lights
  alias: "Turn on lights"
  trigger:
    - platform: state
      entity_id: binary_sensor.iemand_thuis
      to: 'on'
    - platform: state
      entity_id: binary_sensor.dark_outside
      to: 'on'
    - platform: state
      entity_id: binary_sensor.harmony_tv_activity
      to: 'off'
  action:
    service: scene.turn_on
    entity_id: scene.thuis
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: binary_sensor.dark_outside
        state: 'on'
      - condition: state
        entity_id: binary_sensor.iemand_thuis
        state: 'on'
      - condition: state
        entity_id: binary_sensor.harmony_tv_activity
        state: 'off'
      - condition: state
        entity_id: input_boolean.slapen
        state: 'off'

- alias: "Turn off lights"
  trigger:
    - platform: state
      entity_id: binary_sensor.iemand_thuis
      to: 'off'
    - platform: state
      entity_id: binary_sensor.dark_outside
      to: 'off'
    - platform: state
      entity_id: binary_sensor.harmony_tv_activity
      to: 'off'
  action:
    - service: scene.turn_on
      entity_id: scene.lampen_uit
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: 'binary_sensor.dark_outside'
        state: 'off'
      - condition: state
        entity_id: 'binary_sensor.iemand_thuis'
        state: 'off'

- id: harmony_activity_airplay
  alias: "Activate Harmony activity when playing AirPlay"
  hide_entity: True
  trigger:
    platform: state
    entity_id: media_player.yamaha_receiver
    to: 'playing'
  condition:
    - condition: template
      value_template: '{{ states.remote.harmony_hub.attributes.current_activity != "AirPlay" }}'
    - condition: template
      value_template: '{{ trigger.to_state.attributes.source == "AirPlay" }}'
  action:
    - service: remote.turn_on
      entity_id: remote.harmony_hub
      data:
        activity: AirPlay

- id: harmony_activity_spotify_start
  alias: "Activate Harmony activity when playing Spotify"
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.spotify_playing_to_receiver
      from: 'off'
      to: 'on'
  condition:
    - condition: template
      value_template: '{{ states.remote.harmony_hub.attributes.current_activity != "Spotify" }}'
  action:
    - service: remote.turn_on
      entity_id: remote.harmony_hub
      data:
        activity: Spotify

- id: harmony_activity_spotify_stop
  alias: "Stop Harmony activity when playing Spotify"
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.spotify_playing_to_receiver
      from: 'on'
      to: 'off'
      for:
        minutes: 15
  condition:
    - condition: template
      value_template: '{{ states.remote.harmony_hub.attributes.current_activity == "Spotify" }}'
  action:
    - service: remote.turn_off
      entity_id: remote.harmony_hub

- id: harmony_activity_chromecast
  alias: "Activate Chrome Cast activity when casting"
  hide_entity: True
  trigger:
    platform: state
    entity_id: media_player.woonkamer
    to: 'playing'
  condition:
    - condition: template
      value_template: '{{ states.remote.harmony_hub.attributes.current_activity != "Watch Chromecast" }}'
  action:
    - service: remote.turn_on
      entity_id: remote.harmony_hub
      data:
        activity: "Watch Chromecast"

- id: vacuum_cleaner_schedule
  alias: "Stofzuigen"
  trigger:
    platform: state
    entity_id: binary_sensor.iemand_thuis
    to: 'off'
  condition:
    - condition: time
      after: "07:00:00"
      before: "12:00:00"
      weekday:
        - mon
        - fri
  action:
    - service: script.turn_on
      entity_id: script.start_vacuum_cleaner
    - service: notify.ios_iphone_van_luuk
      data:
        message: "Stofzuiger is gestart"

- id: wasmachine_bezig
  alias: "Wasmachine bezig"
  hide_entity: True
  trigger:
    - platform: numeric_state
      entity_id: sensor.wasmachine_actueel_verbruik
      above: 100
  action:
    - service: input_boolean.turn_on
      entity_id: input_boolean.wasmachine_bezig

- id: wasmachine_klaar
  alias: "Wasmachine klaar"
  hide_entity: True
  trigger:
    - platform: numeric_state
      entity_id: sensor.wasmachine_actueel_verbruik
      below: 9
  action:
    - service: input_boolean.turn_off
      entity_id: input_boolean.wasmachine_bezig

- id: wasmachine_klaar_notification
  alias: Wasmachine klaar notification
  trigger:
    - platform: state
      entity_id: input_boolean.wasmachine_bezig
      from: 'on'
      to: 'off'
      for:
        minutes: 8
  action:
    - service: notify.ios_iphone_van_luuk
      data:
        title: "Wasmachine: "
        message: "Ik ben klaar!"

- alias: Lampen keuken aan
  id: kitchen_lights_on
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.bewegingssensor_keuken
      to: 'on'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.lights_keuken
        state: 'off'
      - condition: state
        entity_id: binary_sensor.dark_outside
        state: 'on'
  action:
    - service: light.turn_on
      entity_id: group.lights_keuken

- alias: Lampen keuken uit
  id: kitchen_lights_off
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.bewegingssensor_keuken
      to: 'off'
      for:
        minutes: 5
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.lights_keuken
        state: 'on'
  action:
    - service: light.turn_off
      entity_id: group.lights_keuken
      
- alias: Lampen hal aan
  id: hall_lights_on
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor_158d0001ad6a52
      to: 'on'
  condition:
    - condition: state
      entity_id: binary_sensor.dark_outside
      state: 'on'
  action:
    - service: light.turn_on
      entity_id: light.lamp_hal_achter

- alias: Lampen hal uit
  id: hall_lights_off
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_sensor_158d0001ad6a52
      to: 'off'
  action:
    - service: light.turn_off
      entity_id: light.lamp_hal_achter

- alias: Slapen
  id: slapen
  trigger:
    - platform: state
      entity_id: sensor.iphone_van_luuk_battery_state
      from: 'Unplugged'
      to: 'Charging'
    - platform: state
      entity_id: sensor.iphone_van_luuk_battery_state
      from: 'Unplugged'
      to: 'Full'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: binary_sensor.iemand_thuis
        state: 'on'
      - condition: or
        conditions:
          - condition: time
            after: "23:00:00"
          - condition: time
            before: "05:00:00"
  action:
    service: scene.turn_on
    entity_id: scene.slapen

- alias: Opstaan
  trigger:
    platform: time
    at: "07:30:00"
  action:
    service: scene.turn_on
    entity_id: scene.opstaan
- id: notify_start_heating
  alias: Verwarming inschakelen notificatie
  trigger:
    - platform: time
      at: "17:00:00"
  condition:
    condition: and
    conditions:
      - condition: numeric_state
        entity_id: sensor.woonkamer_temperature
        below: 17.5
      - condition: state
        entity_id: binary_sensor.iemand_thuis
        state: 'off'
      - condition: time
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
  action:
    service: notify.ios_iphone_van_luuk
    data:
      title: "Alvast huis opwarmen?"
      message: "Het is thuis {{ states('sensor.woonkamer_temperature') }}°C. Verwarming alvast aanzetten?"
      data:
        push:
          category: "start_heating"

- id: handle_notification_start_heating
  alias: Verwarming inschakelen notificatie afhandelen
  hide_entity: True
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: START_HEATING
  action:
    - service: climate.set_temperature
      data:
        entity_id: climate.woonkamer
        temperature: 20

- id: mailbox_notification
  alias: "Brievenbusnotificatie"
  hide_entity: True
  trigger:
    - platform: state
      entity_id: binary_sensor.door_window_sensor_158d0001b147ce
      to: "on"
  action:
    - service: notify.ios_iphone_van_luuk
      data:
        title: "Brievenbus:"
        message: "Er is (waarschijnlijk) post!"